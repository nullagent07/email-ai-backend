# Техническое задание (ТЗ) для бэкенда проекта

## Описание проекта

Проект представляет собой систему, где пользователи могут авторизоваться через Gmail, управлять контактами, вести общение с ними через AI-ассистента и просматривать историю сообщений. Фронтенд предоставляет интерфейс для управления контактами и просмотра истории переписки, а бэкенд отвечает за хранение данных, синхронизацию и управление состояниями контактов.

## Требования к бэкенду

### Авторизация и аутентификация

- Реализовать OAuth2 авторизацию через Gmail.
- При успешной авторизации создавать или обновлять профиль пользователя в базе данных.
- Проверять статус подписки пользователя и возвращать информацию о ней.

### Управление пользователями

- Создать таблицу `User` для хранения информации о пользователях:
  - **id** (Primary Key): уникальный идентификатор пользователя.
  - **email**: email пользователя (уникальный).
  - **is_subscription_active** (Boolean): флаг, указывающий на активность подписки.

### Управление контактами

- Создать таблицу `Contact` для хранения информации о контактах пользователя:
  - **id** (Primary Key): уникальный идентификатор контакта.
  - **user_id** (Foreign Key): ссылка на пользователя, которому принадлежит контакт.
  - **email**: email контакта.
  - **name**: имя контакта.
  - **description_ai**: описание AI-ассистента.
  - **is_active** (Boolean): флаг, указывающий, активно ли общение с контактом.
  - **deleted_at** (Datetime, Nullable): дата и время, когда контакт был удален.

- Обеспечить возможность:
  - Обновления статуса контакта (активен/неактивен).
  - Логического удаления контакта через `deleted_at`.

### История сообщений

- Создать таблицу `MessageHistory` для хранения истории сообщений:
  - **id** (Primary Key): уникальный идентификатор сообщения.
  - **user_id** (Foreign Key): ссылка на пользователя, которому принадлежит переписка.
  - **contact_id** (Foreign Key): ссылка на контакт, с которым ведется переписка.
  - **message_direction** (Enum: "sent", "received"): направление сообщения.
  - **message_text**: текст сообщения.
  - **timestamp**: временная метка сообщения.

### Активные общения

- Создать таблицу `ActiveConversation` для отслеживания текущих активных разговоров:
  - **id** (Primary Key): уникальный идентификатор записи.
  - **user_id** (Foreign Key): ссылка на пользователя, который ведет общение.
  - **contact_id** (Foreign Key): ссылка на контакт, с которым ведется общение.
  - **last_interaction_at** (Datetime): временная метка последнего взаимодействия.

### API для управления контактами и сообщениями

- Разработать API для выполнения следующих операций:
  - **Контакты**:
    - Создание контакта.
    - Обновление информации о контакте (включая активацию/деактивацию общения).
    - Логическое удаление контакта.
    - Получение списка контактов пользователя.

### Хранение и безопасность данных

- Все данные пользователей и переписок должны безопасно храниться с шифрованием чувствительных данных.
- Реализовать механизмы защиты API (аутентификация, авторизация).
- Ограничить доступ к данным только авторизованным пользователям.

### Логи и мониторинг

- Реализовать логирование всех операций (создание, обновление, удаление контактов, отправка сообщений и т.д.).
- Обеспечить мониторинг работы сервера и отслеживание ошибок.

### Документация

- Описать все созданные API-эндпоинты, их параметры, методы и форматы ответов.
- Обеспечить инструкцию по развертыванию и настройке сервера, а также интеграции с Gmail API.
